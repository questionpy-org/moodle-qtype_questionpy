{"version":3,"file":"package.min.js","sources":["../../../src/package_search/components/package.js"],"sourcesContent":["/*\n * This file is part of the QuestionPy Moodle plugin - https://questionpy.org\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n */\n\n/**\n * @module qtype_questionpy/package_search/components/package\n */\n\nimport Component from 'qtype_questionpy/package_search/component';\n\nexport default class extends Component {\n    getWatchers() {\n        return [\n            {watch: `${this.category}Packages[${this.packageid}].isfavourite:updated`, handler: this.favouriteChanged},\n        ];\n    }\n\n    create(descriptor) {\n        this.packageid = descriptor.packageid;\n        this.category = descriptor.category;\n        this.selectors = {\n            FAVOURITE_BUTTON: '[data-for=\"favourite-button\"]',\n            DOWNLOAD_BUTTON: '[data-for=\"download-button\"]',\n            VERSION_SELECTION: '.qpy-version-selection',\n        };\n    }\n\n    isFavourite() {\n        return this.getState()[`${this.category}Packages`].get(this.packageid).isfavourite;\n    }\n\n    stateReady() {\n        this.addEventListener(this.getElement(this.selectors.FAVOURITE_BUTTON), \"click\", () => {\n            this.reactive.dispatch(\"favourite\", this.packageid, !this.isFavourite());\n        });\n\n        this.addEventListener(this.getElement(this.selectors.VERSION_SELECTION), \"change\", () => {\n            this.setUpDownloadButton();\n        });\n\n        this.setUpDownloadButton();\n    }\n\n    setUpDownloadButton() {\n        const selection = this.getElement(this.selectors.VERSION_SELECTION);\n        const option = selection.options[selection.selectedIndex];\n        const button = this.getElement(this.selectors.DOWNLOAD_BUTTON);\n        button.classList.toggle(\"d-none\", !option.hasAttribute(\"data-is-mine\"));\n        button.href = option.dataset.fileurl;\n    }\n\n    async favouriteChanged() {\n        const isFavourite = this.isFavourite();\n        this.getElement(this.selectors.FAVOURITE_BUTTON).toggleAttribute(\"data-is-favourite\", isFavourite);\n    }\n}\n"],"names":["Component","getWatchers","watch","this","category","packageid","handler","favouriteChanged","create","descriptor","selectors","FAVOURITE_BUTTON","DOWNLOAD_BUTTON","VERSION_SELECTION","isFavourite","getState","get","isfavourite","stateReady","addEventListener","getElement","reactive","dispatch","setUpDownloadButton","selection","option","options","selectedIndex","button","classList","toggle","hasAttribute","href","dataset","fileurl","toggleAttribute"],"mappings":"gUAuB6BA,mBACzBC,oBACW,CACH,CAACC,gBAAUC,KAAKC,6BAAoBD,KAAKE,mCAAkCC,QAASH,KAAKI,mBAIjGC,OAAOC,iBACEJ,UAAYI,WAAWJ,eACvBD,SAAWK,WAAWL,cACtBM,UAAY,CACbC,iBAAkB,gCAClBC,gBAAiB,+BACjBC,kBAAmB,0BAI3BC,qBACWX,KAAKY,qBAAcZ,KAAKC,sBAAoBY,IAAIb,KAAKE,WAAWY,YAG3EC,kBACSC,iBAAiBhB,KAAKiB,WAAWjB,KAAKO,UAAUC,kBAAmB,SAAS,UACxEU,SAASC,SAAS,YAAanB,KAAKE,WAAYF,KAAKW,uBAGzDK,iBAAiBhB,KAAKiB,WAAWjB,KAAKO,UAAUG,mBAAoB,UAAU,UAC1EU,8BAGJA,sBAGTA,4BACUC,UAAYrB,KAAKiB,WAAWjB,KAAKO,UAAUG,mBAC3CY,OAASD,UAAUE,QAAQF,UAAUG,eACrCC,OAASzB,KAAKiB,WAAWjB,KAAKO,UAAUE,iBAC9CgB,OAAOC,UAAUC,OAAO,UAAWL,OAAOM,aAAa,iBACvDH,OAAOI,KAAOP,OAAOQ,QAAQC,uCAIvBpB,YAAcX,KAAKW,mBACpBM,WAAWjB,KAAKO,UAAUC,kBAAkBwB,gBAAgB,oBAAqBrB"}